<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reportes para Alumnos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .dark-mode { background-color: #212529; color: white; }
        .hidden { display: none; }
    </style>
</head>

<body>
    <!-- Inicio de Sesión -->
    <div id="auth-container" class="container mt-5">
        <h2>Iniciar Sesión</h2>
        <input type="email" id="email" class="form-control mb-2" placeholder="Correo electrónico">
        <input type="password" id="password" class="form-control mb-2" placeholder="Contraseña">
        <button id="login-btn" class="btn btn-primary">Ingresar</button>
        <button id="register-btn" class="btn btn-secondary">Registrar</button>
    </div>

    <!-- Panel de Control -->
    <div id="dashboard" class="container mt-5 hidden">
        <h2>Panel de Control</h2>
        <button id="logout-btn" class="btn btn-danger mb-3">Cerrar Sesión</button>
        <button id="toggle-mode" class="btn btn-dark">Modo Oscuro/Claro</button>

        <!-- Formulario de Reportes -->
        <div id="report-form">
            <h3>Crear Reporte</h3>
            <input type="text" id="student-name" class="form-control mb-2" placeholder="Nombre del Alumno">
            <select id="report-category" class="form-select mb-2">
                <option value="Faltas de respeto">Faltas de respeto a la autoridad</option>
                <option value="Jugar en salón">Jugar en salón</option>
                <option value="Cabello largo">Cabello largo</option>
                <option value="Otro">Otro</option>
            </select>
            <textarea id="report-description" class="form-control mb-2" placeholder="Describe tu problema"></textarea>
            <input type="email" id="student-email" class="form-control mb-2" placeholder="Correo del alumno">
            <input type="text" id="report-teacher" class="form-control mb-2" placeholder="Docente que reporta">
            <button id="submit-report" class="btn btn-success">Enviar Reporte</button>
        </div>

        <!-- Listado de Reportes -->
        <h3 class="mt-5">Listado de Reportes</h3>
        <select id="filter-category" class="form-select mb-2">
            <option value="">Todas las categorías</option>
            <option value="Faltas de respeto">Faltas de respeto a la autoridad</option>
            <option value="Jugar en salón">Jugar en salón</option>
            <option value="Cabello largo">Cabello largo</option>
            <option value="Otro">Otro</option>
        </select>
        <div id="report-list" class="mt-3"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, onSnapshot, updateDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC9uAOgpZw_Xw7sH0pBTlyTjwaQlOX-NQ8",
            authDomain: "report-itace.firebaseapp.com",
            projectId: "report-itace",
            storageBucket: "report-itace.firebasestorage.app",
            messagingSenderId: "806582254097",
            appId: "1:806582254097:web:77edbca4a34be745b14fb0",
            measurementId: "G-MQCPS9V1R2"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore(app);

        const authContainer = document.getElementById('auth-container');
        const dashboard = document.getElementById('dashboard');

        document.getElementById('login-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                alert('Error al iniciar sesión: ' + error.message);
            }
        });

        document.getElementById('register-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                alert('Usuario registrado con éxito.');
            } catch (error) {
                alert('Error al registrar: ' + error.message);
            }
        });

        onAuthStateChanged(auth, (user) => {
            if (user) {
                authContainer.classList.add('hidden');
                dashboard.classList.remove('hidden');
            } else {
                authContainer.classList.remove('hidden');
                dashboard.classList.add('hidden');
            }
        });

        document.getElementById('logout-btn').addEventListener('click', async () => {
            await signOut(auth);
        });

        document.getElementById('toggle-mode').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
        });

        async function saveReport() {
            const report = {
                studentName: document.getElementById('student-name').value,
                category: document.getElementById('report-category').value,
                description: document.getElementById('report-description').value,
                studentEmail: document.getElementById('student-email').value,
                reportTeacher: document.getElementById('report-teacher').value,
                status: 'pendiente',
                createdAt: serverTimestamp()
            };
            await addDoc(collection(db, 'reports'), report);
            alert('Reporte enviado con éxito');
        }

        document.getElementById('submit-report').addEventListener('click', saveReport);
    </script>
</body>

</html>
